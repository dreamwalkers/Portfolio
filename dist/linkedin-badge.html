<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LinkedIn Badge</title>
  <style>
    body{margin:0;background:transparent;font-family:Arial,Helvetica,sans-serif;color:#222}
    .wrap{padding:12px}
    .badge-base{box-sizing:border-box;padding:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="header" style="padding-bottom:8px"></div>
    <div id="badgeContainer">Loading...</div>
  </div>
  <div style="padding:8px;font-size:12px;color:#666" id="info"></div>
  <script>
    function getQuery(name){
      const params = new URLSearchParams(location.search);
      return params.get(name) || '';
    }

    const vanity = getQuery('vanity') || '';
    const href = vanity ? ('https://www.linkedin.com/in/' + vanity) : 'https://www.linkedin.com';
    const displayName = vanity ? '' : 'LinkedIn';

    const header = document.getElementById('header');
    const badgeContainer = document.getElementById('badgeContainer');
    const info = document.getElementById('info');

    function postHeight(){
      try{
        const h = document.body.scrollHeight || document.documentElement.scrollHeight || 160
        // notify parent so it can resize the iframe
        parent.postMessage({type:'linkedin-badge-height', height: h}, '*')
      }catch(e){/* ignore */}
    }
    const name = getQuery('name') || ''
    const title = getQuery('title') || ''

    if (!vanity){
      header.innerHTML = '<div style="padding:12px;border:1px solid #ddd;border-radius:6px;background:#fff"><h3 style="margin:0 0 8px 0">'+(name||'LinkedIn')+'</h3><div style="margin-bottom:8px;color:#444">'+(title||'')+'</div><a href="'+href+'" target="_blank" rel="noreferrer" style="display:inline-block;padding:8px 12px;border-radius:20px;border:2px solid #0e76a8;color:#0e76a8;text-decoration:none">View profile</a></div>';
      badgeContainer.innerHTML = '';
      info.textContent = 'No vanity provided.'
      postHeight()
    } else {
      // place badge inside badgeContainer and keep header separate so LinkedIn script won't overwrite it
      badgeContainer.innerHTML = '<div class="badge-base LI-profile-badge" data-locale="en_US" data-size="large" data-theme="light" data-type="HORIZONTAL" data-vanity="'+vanity+'" data-version="v1">'
        + '<a class="badge-base__link LI-simple-link" href="'+href+'" target="_blank" rel="noreferrer">View profile</a></div>';

      // Render header info (name/title) above the badge
      header.innerHTML = '<div style="padding:8px 0 12px 0"><h3 style="margin:0 0 6px 0">'+(name||'')+'</h3><div style="color:#444;margin-bottom:6px">'+(title||'')+'</div></div>'

      // always show a prominent fallback button so user can open profile if badge fails
      const fallback = document.createElement('div')
      fallback.style.marginTop = '8px'
      fallback.innerHTML = '<a href="'+href+'" target="_blank" rel="noreferrer" style="display:inline-block;padding:10px 14px;border-radius:22px;border:2px solid #0e76a8;color:#0e76a8;text-decoration:none;font-weight:600">View profile</a>'
      badgeContainer.appendChild(fallback)

      info.textContent = 'Using vanity: ' + vanity + ' â€” if this is incorrect, update the profile URL to the full vanity (for example: ninshid-p-h-73253029).'

      // load LinkedIn badges script
      const s = document.createElement('script');
      s.src = 'https://platform.linkedin.com/badges/js/profile.js';
      s.async = true; s.defer = true; s.type = 'text/javascript';
      s.onerror = function(){
        console.warn('LinkedIn badges script load failed');
        // keep fallback visible
      }
      s.onload = function(){
        // after script loads, give it a moment to render badge then inform parent about height
        setTimeout(postHeight, 500)
      }
      document.body.appendChild(s);

      // initial post so parent can size the iframe immediately
      setTimeout(postHeight, 50)
    }
  </script>
</body>
</html>
